{"version":3,"sources":["FallingShipRunningState.ts"],"names":[],"mappings":"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","file":"FallingShipRunningState.js","sourcesContent":["/// <reference path=\"../../typings/phaser/phaser.d.ts\" />\r\n/// <reference path=\"../../typings/jquery/jquery.d.ts\" />\r\n/// <reference path=\"usercode.ts\" />\r\n\r\nimport uc = require(\"UserCode\");\r\nimport ship = require(\"Ship\");\r\n\r\nvar maxSafeVelocity = 20;\r\nvar maxThrust = 300;\r\n\r\nvar colors = {\r\n    Red: '#ff0044', Green: '#069214', Yellow: '#e7f24a', White: '#ffffff'\r\n};\r\n\r\nexport class GameRunningState extends Phaser.State {\r\n\r\n    game: Phaser.Game;\r\n    editor: CodeMirror.Editor;\r\n    \r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    shipSprite: Phaser.Sprite;\r\n    groundColider: Phaser.TileSprite;\r\n    velocityDisplay: Phaser.Text;\r\n    altitudeDisplay: Phaser.Text;\r\n    displayUpdateCount = 0;\r\n\r\n    onGround = false;\r\n    thrusting = false;\r\n    cursors: Phaser.CursorKeys;\r\n    \r\n    userCode: uc.UserCode;\r\n    ship: ship.Ship;\r\n\r\n    create() {\r\n        //console.log('Running state create');\r\n\r\n        var worldWidth = this.game.world.width;\r\n        var worldHeight = this.game.world.height;\r\n        \r\n        this.game.physics.startSystem(Phaser.Physics.P2JS);\r\n        this.game.physics.p2.gravity.y = 100;\r\n\r\n        //this.game.add.tileSprite(0, 0, 800, 600, 'starfield');\r\n\r\n        this.shipSprite = this.game.add.sprite(this.game.world.centerX, 30, \"ship\");\r\n        \r\n        this.game.physics.enable(this.shipSprite, Phaser.Physics.P2JS);\r\n\r\n        this.game.add.tileSprite(0, worldHeight - 18, worldWidth, 18, 'ground');\r\n        this.groundColider = this.game.add.tileSprite(worldWidth / 2, worldHeight, worldWidth, 11, 'groundBlank');\r\n        this.game.physics.enable(this.groundColider, Phaser.Physics.P2JS);\r\n        this.groundColider.body.static = true;\r\n\r\n        this.shipSprite.body.onBeginContact.add((body, bodyB, shapeA, shapeB, equation) => {\r\n            //console.log('contact', shipSprite.body.velocity.y);\r\n            this.landed();\r\n        }, this);\r\n\r\n        this.velocityDisplay = this.game.add.text(10, 10, \"Velocity: 0\", {\r\n            font: '26px Arial',\r\n            fill: colors.Red,\r\n            align: 'left'\r\n        });\r\n\r\n        this.altitudeDisplay = this.game.add.text(400, 10, \"Altitude: \", {\r\n            font: '26px Arial',\r\n            fill: colors.White,\r\n            align: 'left'\r\n        });\r\n\r\n        this.cursors = this.game.input.keyboard.createCursorKeys();\r\n        \r\n        $('#pause').click(() => {\r\n            console.log('Pause');\r\n            this.game.paused = true;\r\n            //this.pauseUpdate();\r\n        });\r\n        $('#resume').click(() => this.game.paused = false);\r\n        \r\n        this.prepUserCode();\r\n        this.ship = new ship.Ship(this.shipSprite, this.game);\r\n    }\r\n\r\n    update() {\r\n        if (this.cursors.up.isDown) {\r\n            this.ship.thrust();\r\n        } else if (this.ship.thrusting) {\r\n            this.ship.stopThrust();\r\n        }\r\n        \r\n        this.userCode.execute(this.ship);\r\n    }\r\n\r\n    render() {\r\n        if (!this.onGround) {\r\n            this.displayFlightData();\r\n        }\r\n    }\r\n\r\n    displayFlightData() {\r\n        if (this.displayUpdateCount === 0)\r\n        {\r\n            this.displayUpdateCount = 3;\r\n\r\n            //#region Velocity\r\n             \r\n            var speed = this.ship.speed();\r\n            if (speed > maxSafeVelocity) {\r\n                //console.log(`greater than ${maxSafeVelocity}`);\r\n                this.velocityDisplay.fill = colors.Red;\r\n            } else if (speed < maxSafeVelocity && speed >= 0) {\r\n                //console.log(`less than ${maxSafeVelocity}`);\r\n                this.velocityDisplay.fill = colors.Green;\r\n            } else if (speed < 0) {\r\n                this.velocityDisplay.fill = colors.Yellow;\r\n            }\r\n\r\n            this.velocityDisplay.setText(`Velocity: ${speed.toFixed(1) }`);    \r\n\r\n            //#endregion\r\n\r\n            this.altitudeDisplay.setText(`Altitude: ${Math.abs(this.ship.altitude()).toFixed() }`);\r\n        }\r\n\r\n        this.displayUpdateCount--;\r\n    }\r\n    \r\n    landed() {\r\n        this.onGround = true;\r\n\r\n        if (this.ship.speed() > 20) {\r\n            this.ship.explode();\r\n            \r\n            var crashedText = this.game.add.text(this.game.world.centerX, this.game.world.centerY, \"You Crashed!\", { font: '50px Arial', fill: '#ff0044', align: 'center' });\r\n            crashedText.anchor.set(0.5);\r\n        }\r\n    }\r\n\r\n    prepUserCode()\r\n    {\r\n        let userCodeString = this.editor.getDoc().getValue();\r\n        this.userCode = new uc.UserCode(userCodeString);\r\n    }\r\n}"]}